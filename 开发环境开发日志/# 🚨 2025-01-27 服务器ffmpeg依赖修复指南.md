# ğŸš¨ 2025-01-27 æœåŠ¡å™¨ffmpegä¾èµ–ä¿®å¤æŒ‡å—

## ğŸš¨ é—®é¢˜æè¿°
æœåŠ¡å™¨å‡ºç° `Cannot find module 'ffmpeg-static'` é”™è¯¯ï¼Œå¯¼è‡´æœåŠ¡ä¸æ–­é‡å¯ã€‚

**é”™è¯¯ä¿¡æ¯**:
```
Error: Cannot find module 'ffmpeg-static'
Require stack:
- /var/www/mj-gallery/server/routes/upload.js
- /var/www/mj-gallery/server/index.js
```

## ğŸ” é—®é¢˜åˆ†æ
1. **ä¾èµ–ä¸åŒ¹é…**: æœ¬åœ°å¼€å‘ç¯å¢ƒå·²ç»ä» `ffmpeg-static` åˆ‡æ¢åˆ° `@ffmpeg-installer/ffmpeg`
2. **æ–‡ä»¶åŒæ­¥é—®é¢˜**: æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¯èƒ½æ²¡æœ‰æ­£ç¡®åŒæ­¥
3. **ä¾èµ–å®‰è£…é—®é¢˜**: æœåŠ¡å™¨ä¸Šçš„ node_modules å¯èƒ½åŒ…å«æ—§çš„ä¾èµ–é…ç½®

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰
1. å°† `fix-server-ffmpeg.sh` ä¸Šä¼ åˆ°æœåŠ¡å™¨
2. åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š
```bash
chmod +x fix-server-ffmpeg.sh
bash fix-server-ffmpeg.sh
```

### æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨ä¿®å¤
åœ¨æœåŠ¡å™¨ä¸Šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/mj-gallery/server

# åœæ­¢ PM2 è¿›ç¨‹
pm2 stop all

# æ¸…ç†æ—§ä¾èµ–
rm -rf node_modules
rm -f package-lock.json

# é‡æ–°å®‰è£…ä¾èµ–
npm install

# é‡å¯æœåŠ¡
pm2 start ecosystem.config.js

# æ£€æŸ¥çŠ¶æ€
pm2 logs
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•
- [ ] ç¡®è®¤ `package.json` ä¸­åŒ…å« `"@ffmpeg-installer/ffmpeg": "^1.1.0"`
- [ ] ç¡®è®¤ `routes/upload.js` ä½¿ç”¨æ­£ç¡®çš„å¯¼å…¥ï¼š`require('@ffmpeg-installer/ffmpeg').path`
- [ ] ç¡®è®¤æ²¡æœ‰æ–‡ä»¶å¼•ç”¨ `ffmpeg-static`
- [ ] é‡æ–°å®‰è£…ä¾èµ–åæ£€æŸ¥ `node_modules/@ffmpeg-installer` ç›®å½•å­˜åœ¨
- [ ] æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨ä¸”æ— é”™è¯¯æ—¥å¿—

## ğŸ“ ç›¸å…³æ–‡ä»¶
- `server/package.json`: ä¾èµ–é…ç½®æ–‡ä»¶
- `server/routes/upload.js`: æ–‡ä»¶ä¸Šä¼ è·¯ç”±ï¼ˆä½¿ç”¨ ffmpegï¼‰
- `server/scripts/generateThumbnails.js`: ç¼©ç•¥å›¾ç”Ÿæˆè„šæœ¬
- `fix-server-ffmpeg.sh`: è‡ªåŠ¨ä¿®å¤è„šæœ¬

## ğŸ¯ é¢„æœŸç»“æœ
- æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨ï¼Œä¸å†å‡ºç° ffmpeg-static é”™è¯¯
- è§†é¢‘ä¸Šä¼ åŠŸèƒ½æ­£å¸¸ï¼Œèƒ½å¤Ÿç”Ÿæˆç¼©ç•¥å›¾
- PM2 è¿›ç¨‹ç¨³å®šè¿è¡Œï¼Œä¸å†é‡å¯

## ğŸ“ æ³¨æ„äº‹é¡¹
1. æ‰§è¡Œä¿®å¤å‰è¯·å¤‡ä»½é‡è¦æ•°æ®
2. ä¿®å¤è¿‡ç¨‹ä¸­æœåŠ¡ä¼šçŸ­æš‚ä¸­æ–­
3. å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æ˜¯å¦ä¸æœ¬åœ°ä¸€è‡´
4. ç¡®ä¿æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´è¿›è¡Œä¾èµ–å®‰è£…

---

**ä¿®å¤çŠ¶æ€**: ğŸ”„ å¾…æ‰§è¡Œ  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**å½±å“èŒƒå›´**: è§†é¢‘ä¸Šä¼ å’Œç¼©ç•¥å›¾ç”ŸæˆåŠŸèƒ½