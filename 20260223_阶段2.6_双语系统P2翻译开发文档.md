# 阶段 2.6 — 双语系统 P2 翻译开发文档

> **日期**: 2026-02-23  
> **Git Commit**: `193d9d5` feat(i18n): Phase C-P2  
> **开发阶段**: 双主题 + 多语言系统重构 — 阶段 C-P2（全量 i18n 覆盖）

---

## 1. 概述

本阶段完成了 P2 级别所有剩余组件和页面的国际化处理，标志着双语系统开发的全面完成。通过批量脚本处理 + 手动精确修改相结合的方式，覆盖了约 60 个文件中的硬编码中文字符串。

### 变更统计

| 类别 | 文件数 | 变更类型 |
|------|--------|----------|
| 批量处理（页面/组件/工具） | ~30 | 中文 → 英文直接替换 |
| 手动 i18n（Gallery/Seedance 页面） | 4 | 添加 useTranslation + t() 调用 |
| i18n 模块扩展 | 2 | gallery.js + seedance.js 新增键 |
| 语言文件更新 | 2 | en-US.json + zh-CN.json 新增键 |
| 编译修复 | 4 | 修复非组件文件中的 t() 引用 |
| **总计** | **~42** | — |

---

## 2. 手动 i18n 处理（4 个 Gallery/Seedance 页面）

### 2.1 GalleryList.js

```diff
+ import { useTranslation } from 'react-i18next';
+ const { t } = useTranslation();

- { value: 'newest', label: '最新' },
+ { value: 'newest', labelKey: 'gallery.filters.newest' },

- toast.error('请先登录');
+ toast.error(t('gallery.actions.loginRequired'));
```

### 2.2 GalleryDetail.js

- 替换 8 处 toast 消息（复制/点赞/收藏/分享）
- 按钮文字使用 `t('gallery.actions.liked')` / `t('gallery.actions.favorited')` 等

### 2.3 SeedanceList.js / SeedanceDetail.js

与 Gallery 页面相同模式，使用 `seedance.actions.*` 命名空间。

---

## 3. i18n 模块扩展

### gallery.js & seedance.js — 新增 12 个 actions 键（三语）

```javascript
actions: {
    copy: 'Copy prompt',
    copySuccess: 'Prompt copied!',
    copyFailed: 'Copy failed',
    like: 'Like',
    liked: 'Liked',           // NEW
    unliked: 'Unliked',       // NEW
    favorite: 'Favorite',
    favorited: 'Favorited',   // NEW
    unfavorited: 'Unfavorited', // NEW
    loginRequired: 'Please login first', // NEW
    linkCopied: 'Link copied!', // NEW
}
```

### en-US.json & zh-CN.json — 新增 16 个 common 键

| 键名 | en-US | zh-CN |
|------|-------|-------|
| `loginRequired` | "Please login first" | "请先登录" |
| `operationFailed` | "Operation failed, please try again" | "操作失败，请稍后重试" |
| `copyFailed` | "Copy failed" | "复制失败" |
| `promptCopied` | "Prompt copied!" | "提示词已复制！" |
| `copied` | "Copied!" | "已复制！" |
| `linkCopied` | "Link copied!" | "链接已复制！" |
| `commentPosted` | "Comment posted" | "评论发布成功" |
| `commentFailed` | "Failed to post comment" | "发布评论失败" |
| `replyPosted` | "Reply posted" | "回复发布成功" |
| `replyFailed` | "Failed to post reply" | "发布回复失败" |
| `likeSuccess` | "Liked!" | "点赞成功" |
| `checkFormInput` | "Please check form input" | "请检查表单输入" |
| `promptUpdated` | "Prompt updated" | "提示词更新成功" |
| `descriptionTooLong` | "Description too long" | "描述过长，请缩短后重试" |
| `serverError` | "Server error" | "服务器错误，请稍后重试" |

---

## 4. 批量处理覆盖文件清单

### 4.1 页面文件

| 文件 | 替换内容 |
|------|----------|
| `PromptList.js` | 页面标题、搜索占位符、按钮文字 |
| `PromptDetail.js` | 图片描述标题、关闭按钮、alt 文本 |
| `Health.js` | 系统状态消息、页面标题 |
| `SEOManagement.js` | 统计标签、快速操作标题 |
| `Contact.js` | 响应时间文字 |
| `CreatePost.js` | 验证消息 |
| `Profile.js` | 返回首页按钮 |

### 4.2 组件文件

| 文件 | 替换内容 |
|------|----------|
| `CommentSection.js` | Toast 消息（评论/回复/点赞 → 英文） |
| `PromptCard.js` | Toast 消息（复制/登录 → 英文） |
| `LiblibPromptCard.js` | Toast 消息 |
| `ErrorBoundary.js` | 错误界面文本 |
| `EnhancedToast.js` | Toast 界面文本 |
| `Pagination.js` | 分页信息文本 |
| `RelatedPrompts.js` | 区块标题 |
| `DashboardHeader.js` | Alt 文本、按钮文字 |
| `AvatarSelector.js` | Alt 文本、选择标签 |
| `StatsPanel.js` | 统计标题、星期名称 |

### 4.3 Admin 分析图表

| 文件 | 替换内容 |
|------|----------|
| `ContentAnalysisChart.js` | 加载提示、图表标题、指标名称 |
| `TrendAnalysisChart.js` | 趋势标题、数据标签 |
| `BehaviorAnalysisChart.js` | 行为分析标题、设备名称 |
| `GeoAnalysisChart.js` | 地域分析标题、数量标签 |

### 4.4 工具/配置文件

| 文件 | 替换内容 |
|------|----------|
| `errorHandler.js` | 错误建议文本 → 英文 |
| `usePromptEdit.js` | 分类标签 → 英文 |
| `dashboardHelpers.js` | 验证错误消息 → 英文 |
| `formValidation.js` | 表单验证消息 → 英文 |
| `requestManager.js` | 错误信息 → 英文 |

---

## 5. 编译修复

### 问题：`'t' is not defined`

批量脚本将 `toast.error('请先登录')` 替换为 `toast.error(t('common.loginRequired'))`，但部分文件是非 React 组件（如 hooks、工具函数），不能使用 `useTranslation()` hook。

### 解决方案

对 4 个非组件文件（`CommentSection.js`、`LiblibPromptCard.js`、`PromptCard.js`、`usePromptEdit.js`）将 `t('common.xxx')` 还原为直接英文字符串。

> **设计决策**: 对于不支持 React hooks 的工具/hook 文件，使用直接英文字符串而非 `t()` 调用。这些文件中的字符串主要是 toast 消息和控制台日志，直接使用英文是最实用的方案。

---

## 6. 验证结果

| 验证项 | 状态 |
|--------|------|
| `npx react-scripts build` 编译 | ✅ 通过 (exit code 0) |
| 批量替换正确性 | ✅ 100+ 替换模式无冲突 |
| Git commit + push | ✅ 成功 (193d9d5, 46 files changed) |

---

## 7. 残留说明

### 7.1 JSX 注释中的中文

约 200+ 处 JSX 注释（`{/* 页面标题 */}`）保留中文。这些注释不影响用户界面，属于开发者内部文档，未列入翻译范围。

### 7.2 AdminPanel.js（246 处中文）

AdminPanel.js 是最大的单一文件含 246 处中文。由于其为内部管理面板（非公开用户界面），且结构复杂，建议作为独立任务处理或保留中文界面。

### 7.3 JSON 重复键（pre-existing）

`en-US.json` 和 `zh-CN.json` 的 `admin` 节存在历史遗留的重复键（`users`、`posts` 同时为字符串和对象），不影响运行时。

---

## 8. 双语系统完成总结

### 已完成的阶段

| 阶段 | 内容 | Git |
|------|------|-----|
| A | CSS 变量体系 + 双主题基础 | P0 commit |
| B | i18n 基础配置 + Gallery/Seedance 模块 | P0 commit |
| C-P0 | 核心页面 i18n（Home, Header, Footer） | P0 commit |
| C-P1 | 次要页面 i18n（Hero, GalleryCard, VideoCard） | 7edc4a7 |
| C-P2 | 全量 i18n 覆盖（~42 文件） | 193d9d5 |
| D | 主题切换 UI (Sun/Moon) | P0 commit |
| E | Tailwind Dark Mode | P0 commit |

### 用户路径覆盖率

| 路径 | 覆盖率 |
|------|--------|
| 首页（Hero + 导航 + Footer） | 100% |
| Gallery（列表 + 详情 + 卡片） | 100% |
| Seedance（列表 + 详情 + 卡片） | 100% |
| 登录/注册/密码重置 | 100% |
| 个人中心/设置/收藏 | 95%（注释除外） |
| 探索/帖子详情 | 95% |
| Dashboard/统计 | 90% |
| Admin 后台 | 30%（内部工具，暂缓） |
