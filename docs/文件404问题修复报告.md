root@SG20241128:/var/www/mj-gallery# node fix-pm2-env-config.js
ğŸ”§ å¼€å§‹ä¿®å¤PM2ç¯å¢ƒå˜é‡é…ç½®...
ğŸ“‹ åŠ è½½çš„ç¯å¢ƒå˜é‡:
  PORT: 5500
  NODE_ENV: development
  TRUST_PROXY: true
  MONGODB_URI: mongodb://localhost:27017/midjourney-gallery
  JWT_SECRET: [å·²éšè—]
  CLIENT_URL: https://iii.pics
  MAX_FILE_SIZE: 10485760
  UPLOAD_PATH: ./uploads
  EMAIL_ENABLED: true
  SMTP_HOST: smtpdm.aliyun.com
  SMTP_PORT: 465
  SMTP_SECURE: true
  SMTP_USER: i@mail.iii.pics
  SMTP_PASS: [å·²éšè—]
  EMAIL_FROM_NAME: MJ Gallery
  EMAIL_FROM_ADDRESS: i@mail.iii.pics
âœ… å·²å¤‡ä»½åŸé…ç½®æ–‡ä»¶åˆ° ecosystem.config.js.backup
âœ… å·²æ›´æ–° ecosystem.config.js é…ç½®æ–‡ä»¶

ğŸš€ ä¿®å¤å®Œæˆï¼è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤é‡å¯æœåŠ¡å™¨:
   pm2 restart mj-gallery-server
   pm2 logs mj-gallery-server --lines 20
root@SG20241128:/var/www/mj-gallery#    pm2 restart mj-gallery-server
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [mj-gallery-server](ids: [ 0 ])
[PM2] [mj-gallery-server](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ mj-gallery-server  â”‚ fork     â”‚ 8    â”‚ online    â”‚ 0%       â”‚ 17.9mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@SG20241128:/var/www/mj-gallery#    pm2 logs mj-gallery-server --lines 20
[TAILING] Tailing last 20 lines for [mj-gallery-server] process (change the value with --lines option)
/var/www/mj-gallery/logs/err-0.log last 20 lines:
0|mj-galle | 2025-07-24 20:09:45: Error: ENOENT: no such file or directory, open 'uploads/media-1753427385955-426707674.jpg'
0|mj-galle | 2025-07-24 20:10:18: Error: ENOENT: no such file or directory, open 'uploads/media-1753427418086-548027098.jpg'
0|mj-galle | 2025-07-24 20:19:02: Error: ENOENT: no such file or directory, open 'uploads/media-1753427942778-12603813.jpg'
0|mj-galle | 2025-07-24 20:20:24: Error: ENOENT: no such file or directory, open 'uploads/media-1753428024687-237257551.jpg'
0|mj-galle | 2025-07-24 20:20:52: Error: ENOENT: no such file or directory, open 'uploads/media-1753428052758-195130103.jpg'
0|mj-galle | 2025-07-24 20:21:10: Error: ENOENT: no such file or directory, open 'uploads/media-1753428070149-696401938.jpg'
0|mj-galle | 2025-07-24 20:21:23: Error: ENOENT: no such file or directory, open 'uploads/media-1753428083795-518786826.jpg'
0|mj-galle | 2025-07-24 20:30:08: TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string. Received an instance of ObjectId
0|mj-galle | 2025-07-24 20:30:08:     at Object.join (node:path:1292:7)
0|mj-galle | 2025-07-24 20:30:08:     at DiskStorage.destination [as getDestination] (/var/www/mj-gallery/server/routes/posts.js:76:25)
0|mj-galle | 2025-07-24 20:30:08:     at DiskStorage._handleFile (/var/www/mj-gallery/server/node_modules/multer/storage/disk.js:31:8)
0|mj-galle | 2025-07-24 20:30:08:     at /var/www/mj-gallery/server/node_modules/multer/lib/make-middleware.js:139:17
0|mj-galle | 2025-07-24 20:30:08:     at fileFilter (/var/www/mj-gallery/server/routes/posts.js:104:14)
0|mj-galle | 2025-07-24 20:30:08:     at wrappedFileFilter (/var/www/mj-gallery/server/node_modules/multer/index.js:44:7)
0|mj-galle | 2025-07-24 20:30:08:     at Multipart.<anonymous> (/var/www/mj-gallery/server/node_modules/multer/lib/make-middleware.js:109:7)
0|mj-galle | 2025-07-24 20:30:08:     at Multipart.emit (node:events:524:28)
0|mj-galle | 2025-07-24 20:30:08:     at HeaderParser.cb (/var/www/mj-gallery/server/node_modules/busboy/lib/types/multipart.js:358:14)
0|mj-galle | 2025-07-24 20:30:08:     at HeaderParser.push (/var/www/mj-gallery/server/node_modules/busboy/lib/types/multipart.js:162:20) {
0|mj-galle | 2025-07-24 20:30:08:   code: 'ERR_INVALID_ARG_TYPE'
0|mj-galle | 2025-07-24 20:30:08: }

/var/www/mj-gallery/logs/out-0.log last 20 lines:
0|mj-galle | 2025-07-24 20:23:33: âœ… é…ç½®éªŒè¯é€šè¿‡
0|mj-galle | 2025-07-24 20:23:33: âœ… æœåŠ¡å™¨é…ç½®åŠ è½½å®Œæˆ [production:5500]
0|mj-galle | 2025-07-24 20:23:33: é‚®ä»¶æœåŠ¡å·²åˆå§‹åŒ–
0|mj-galle | 2025-07-24 20:23:34: âœ… MongoDBè¿æ¥æˆåŠŸ
0|mj-galle | 2025-07-24 20:23:34: ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5500
0|mj-galle | 2025-07-24 20:26:19: âœ… é…ç½®éªŒè¯é€šè¿‡
0|mj-galle | 2025-07-24 20:26:19: âœ… æœåŠ¡å™¨é…ç½®åŠ è½½å®Œæˆ [production:5500]
0|mj-galle | 2025-07-24 20:26:19: é‚®ä»¶æœåŠ¡å·²åˆå§‹åŒ–
0|mj-galle | 2025-07-24 20:26:19: âœ… MongoDBè¿æ¥æˆåŠŸ
0|mj-galle | 2025-07-24 20:26:19: ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5500
0|mj-galle | 2025-07-24 20:29:13: âœ… é…ç½®éªŒè¯é€šè¿‡
0|mj-galle | 2025-07-24 20:29:13: âœ… æœåŠ¡å™¨é…ç½®åŠ è½½å®Œæˆ [production:5500]
0|mj-galle | 2025-07-24 20:29:13: é‚®ä»¶æœåŠ¡å·²åˆå§‹åŒ–
0|mj-galle | 2025-07-24 20:29:13: âœ… MongoDBè¿æ¥æˆåŠŸ
0|mj-galle | 2025-07-24 20:29:13: ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5500
0|mj-galle | 2025-07-24 20:30:10: âœ… é…ç½®éªŒè¯é€šè¿‡
0|mj-galle | 2025-07-24 20:30:10: âœ… æœåŠ¡å™¨é…ç½®åŠ è½½å®Œæˆ [production:5500]
0|mj-galle | 2025-07-24 20:30:10: é‚®ä»¶æœåŠ¡å·²åˆå§‹åŒ–
0|mj-galle | 2025-07-24 20:30:10: âœ… MongoDBè¿æ¥æˆåŠŸ
0|mj-galle | 2025-07-24 20:30:10: ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5500

0|mj-gallery-server  | 2025-07-24 20:38:41: âœ… é…ç½®éªŒè¯é€šè¿‡
0|mj-gallery-server  | 2025-07-24 20:38:41: âœ… æœåŠ¡å™¨é…ç½®åŠ è½½å®Œæˆ [production:5500]
0|mj-gallery-server  | 2025-07-24 20:38:41: é‚®ä»¶æœåŠ¡å·²åˆå§‹åŒ–
0|mj-gallery-server  | 2025-07-24 20:38:41: âœ… MongoDBè¿æ¥æˆåŠŸ
0|mj-gallery-server  | 2025-07-24 20:38:41: ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5500
0|mj-gallery-server  | 2025-07-24 20:39:02: TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string. Received an instance of ObjectId
0|mj-gallery-server  | 2025-07-24 20:39:02:     at Object.join (node:path:1292:7)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at DiskStorage.destination [as getDestination] (/var/www/mj-gallery/server/routes/posts.js:76:25)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at DiskStorage._handleFile (/var/www/mj-gallery/server/node_modules/multer/storage/disk.js:31:8)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at /var/www/mj-gallery/server/node_modules/multer/lib/make-middleware.js:139:17
0|mj-gallery-server  | 2025-07-24 20:39:02:     at fileFilter (/var/www/mj-gallery/server/routes/posts.js:104:14)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at wrappedFileFilter (/var/www/mj-gallery/server/node_modules/multer/index.js:44:7)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at Multipart.<anonymous> (/var/www/mj-gallery/server/node_modules/multer/lib/make-middleware.js:109:7)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at Multipart.emit (node:events:524:28)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at HeaderParser.cb (/var/www/mj-gallery/server/node_modules/busboy/lib/types/multipart.js:358:14)
0|mj-gallery-server  | 2025-07-24 20:39:02:     at HeaderParser.push (/var/www/mj-gallery/server/node_modules/busboy/lib/types/multipart.js:162:20) {
0|mj-gallery-server  | 2025-07-24 20:39:02:   code: 'ERR_INVALID_ARG_TYPE'
0|mj-gallery-server  | 2025-07-24 20:39:02: }
0|mj-gallery-server  | 2025-07-24 20:39:04: âœ… é…ç½®éªŒè¯é€šè¿‡
0|mj-gallery-server  | 2025-07-24 20:39:04: âœ… æœåŠ¡å™¨é…ç½®åŠ è½½å®Œæˆ [production:5500]
0|mj-gallery-server  | 2025-07-24 20:39:04: é‚®ä»¶æœåŠ¡å·²åˆå§‹åŒ–
0|mj-gallery-server  | 2025-07-24 20:39:04: âœ… MongoDBè¿æ¥æˆåŠŸ
0|mj-gallery-server  | 2025-07-24 20:39:04: ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5500
