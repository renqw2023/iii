# 502错误修复和端口配置更新日志

## 📅 修复时间
2025-01-25

## 🐛 问题描述
用户在浏览器中访问项目时遇到502错误：
- `/api/posts/featured` - 502错误
- `/api/posts/tags/popular` - 502错误
- `/api/posts` - 502错误
- `/favicon.ico` - 404错误

## 🔍 问题分析
502错误通常表示：
1. 后端服务器未启动
2. 端口配置不匹配
3. 代理配置错误
4. 服务器内部错误

## 🛠️ 解决方案

### 1. 端口配置统一更新
发现启动脚本中的端口显示信息仍然是旧版本（3000/5000），而实际配置已更新为（3100/5500）。

#### 更新的文件：
- ✅ `start.js` - 更新端口显示信息
  - 前端地址：http://localhost:3000 → http://localhost:3100
  - 后端地址：http://localhost:5000 → http://localhost:5500
  - 管理面板：http://localhost:3000/admin → http://localhost:3100/admin

- ✅ `start-clean.js` - 更新端口显示信息
  - 前端地址：http://localhost:3000 → http://localhost:3100
  - 后端地址：http://localhost:5000 → http://localhost:5500
  - 管理面板：http://localhost:3000/admin → http://localhost:3100/admin

- ✅ `server/config/index.js` - 更新默认端口配置
  - 默认端口：5000 → 5500
  - 默认客户端URL：http://localhost:3000 → http://localhost:3100

### 2. 配置文件验证
确认以下配置文件已正确设置：
- ✅ `server/.env` - PORT=5500
- ✅ `client/.env` - REACT_APP_API_URL=http://localhost:5500/api
- ✅ `client/package.json` - PORT=3100, proxy=http://localhost:5500

## 🚀 启动建议

### 正确的启动流程：
1. 确保MongoDB服务正在运行
2. 使用以下命令启动项目：
   ```bash
   # 方式1：同时启动前后端
   npm run dev
   
   # 方式2：分别启动
   npm run server-only  # 后端：http://localhost:5500
   npm run client-only  # 前端：http://localhost:3100
   ```

### 验证步骤：
1. 检查后端服务器是否在5500端口启动成功
2. 检查前端是否在3100端口启动成功
3. 访问 http://localhost:3100 验证前端
4. 访问 http://localhost:5500/api/health 验证后端API

## 🔧 故障排除

### 如果仍然出现502错误：
1. 检查MongoDB连接状态
2. 查看服务器启动日志
3. 确认防火墙设置
4. 检查端口是否被其他进程占用

### 常用调试命令：
```bash
# 检查端口占用（Windows）
netstat -ano | findstr :5500
netstat -ano | findstr :3100

# 检查MongoDB状态
mongo --eval "db.adminCommand('ismaster')"
```

## 📝 总结
本次修复主要解决了启动脚本中端口信息显示不一致的问题，确保所有配置文件和脚本都使用统一的端口配置（前端3100，后端5500）。这应该能解决502错误问题，前提是确保后端服务器正常启动。