# 阶段6 补丁2 — /gallery 卡片悬浮效果修复

**日期**：2026-02-26
**分支**：main
**涉及文件**：`client/src/styles/gallery.css` / `client/src/components/Gallery/GalleryCard.js`

---

## 一、问题描述

`/gallery` 页面的卡片悬浮（hover）效果缺失，具体表现：

- 鼠标移动到图片卡片上，底部渐变遮罩（overlay）不出现
- 图片没有轻微放大（scale）的动效
- 对比 `/explore` 页面，后者有明显的图片缩放 + 渐变遮罩效果

而 `/explore` 使用的 `LiblibStyleCard.css` 已包含完整的 hover 动效。

---

## 二、排查过程

### 2.1 DevTools 检查 CSS 规则

确认 `.gallery-card:hover .gallery-card-overlay` 规则已正确加载：

```
.gallery-card-overlay { opacity: 0; transition: opacity 0.25s ease; }
.gallery-card:hover .gallery-card-overlay { opacity: 1; pointer-events: auto; }
```

DOM 结构正确，overlay 元素在图片加载后存在于 DOM 中。

### 2.2 发现缺失的 img transition 规则

`gallery.css` 中 `.gallery-card-image` 容器没有针对 `img` 元素的样式规则，而 `LiblibStyleCard.css` 里有：

```css
/* LiblibStyleCard.css — 存在 */
.liblib-card-image img {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.4s ease;
}
.liblib-card:hover .liblib-card-image img {
  transform: scale(1.03);
}
```

`gallery.css` 完全缺少这两条规则，导致图片无 scale 动效。

### 2.3 发现 inline style 覆盖 CSS transition

补充 `gallery.css` img 规则后，通过 DevTools 检查 computed style：

```
imgTransition: "opacity 0.4s ease-in"
```

图片的 transition 只有 `opacity`，没有 `transform`。

根因：`GalleryCard.js` 中 `<img>` 使用了 inline style 控制渐入效果：

```jsx
style={{
  opacity: imageLoaded ? 1 : 0,
  transition: 'opacity 0.4s ease-in',   // ← 覆盖了 CSS 的 transition: transform
}}
```

inline style 的 `transition` 属性完整覆盖了 CSS 文件中的 `transition: transform 0.4s ease`，导致 transform 动画失效。

---

## 三、修复方案

### Fix 1 — gallery.css 补充 img hover 规则

**文件**：`client/src/styles/gallery.css`

在 `.gallery-card-image` 块后追加：

```css
.gallery-card-image img {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.4s ease;
}

.gallery-card:hover .gallery-card-image img {
  transform: scale(1.03);
}
```

### Fix 2 — GalleryCard.js 合并 transition

**文件**：`client/src/components/Gallery/GalleryCard.js`

```jsx
// 改前
style={{
  opacity: imageLoaded ? 1 : 0,
  transition: 'opacity 0.4s ease-in',
}}

// 改后
style={{
  opacity: imageLoaded ? 1 : 0,
  transition: 'opacity 0.4s ease-in, transform 0.4s ease',
}}
```

将两个 transition 合并为逗号分隔的多值，同时保留 opacity 渐入和 transform scale 动效。

---

## 四、验证

修复后 DevTools 确认：

```
imgTransition: "opacity 0.4s ease-in, transform 0.4s"
```

两个 transition 值均生效。鼠标悬浮时：
- 图片轻微放大（`scale(1.03)`，与 `/explore` 一致）
- 底部渐变遮罩淡入（opacity 0 → 1）
- 显示作者名、点赞数、浏览数、操作按钮

---

## 五、技术要点

### inline style 与 CSS 的 transition 冲突

CSS 的 `transition` 属性是"全量覆盖"的，inline style 会完全取代 CSS 文件中同属性的值。

```
CSS:          transition: transform 0.4s ease;
inline style: transition: opacity 0.4s ease-in;
结果:         只有 opacity transition 生效，transform 被丢弃
```

**正确做法**：需要多个 transition 时，在同一个声明中用逗号分隔：

```
transition: opacity 0.4s ease-in, transform 0.4s ease;
```

---

## 六、受影响文件

| 文件 | 改动 |
|------|------|
| `client/src/styles/gallery.css` | 新增 `.gallery-card-image img` 和 hover scale 规则 |
| `client/src/components/Gallery/GalleryCard.js` | img inline style transition 合并 |
