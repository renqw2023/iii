# æœåŠ¡å™¨éƒ¨ç½²é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ `npm run build` æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```bash
root@SG20241128:/var/www/mj-gallery/client# npm run build

> midjourney-gallery-client@1.0.0 build
> react-scripts build

sh: 1: react-scripts: not found
```

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
**ç¼ºå°‘ node_modules ä¾èµ–**ï¼šæœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£…é¡¹ç›®çš„ä¾èµ–åŒ…ï¼Œç‰¹åˆ«æ˜¯ `react-scripts`ã€‚

### ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜
1. **åªä¸Šä¼ äº†æºä»£ç æ–‡ä»¶**ï¼Œæ²¡æœ‰ä¸Šä¼  `node_modules` ç›®å½•
2. **æ²¡æœ‰åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ `npm install`** å®‰è£…ä¾èµ–
3. **node_modules é€šå¸¸è¢« .gitignore å¿½ç•¥**ï¼Œä¸ä¼šè¢« Git è·Ÿè¸ª

### æŠ€æœ¯èƒŒæ™¯
- `react-scripts` æ˜¯ Create React App çš„æ ¸å¿ƒå·¥å…·
- å®ƒåŒ…å«äº†æ„å»ºã€æµ‹è¯•ã€å¼€å‘æœåŠ¡å™¨ç­‰åŠŸèƒ½
- å¿…é¡»é€šè¿‡ `npm install` å®‰è£…åˆ° `node_modules` ä¸­

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ ‡å‡†éƒ¨ç½²æµç¨‹ï¼ˆæ¨èï¼‰

#### 1. åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/mj-gallery

# å®‰è£…æ ¹ç›®å½•ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
npm install

# å®‰è£…æœåŠ¡å™¨ç«¯ä¾èµ–
cd server
npm install

# å®‰è£…å®¢æˆ·ç«¯ä¾èµ–
cd ../client
npm install

# æ„å»ºå‰ç«¯
npm run build
```

#### 2. é‡å¯æœåŠ¡
```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd /var/www/mj-gallery

# é‡å¯ PM2 æœåŠ¡
pm2 restart all

# æˆ–è€…é‡å¯ç‰¹å®šæœåŠ¡
pm2 restart mj-gallery
```

### æ–¹æ¡ˆäºŒï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

åˆ›å»ºéƒ¨ç½²è„šæœ¬ `deploy.sh`ï¼š
```bash
#!/bin/bash

# éƒ¨ç½²è„šæœ¬
echo "ğŸš€ å¼€å§‹éƒ¨ç½² MJ Gallery..."

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/mj-gallery

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install
cd server && npm install && cd ..
cd client && npm install && cd ..

# æ„å»ºå‰ç«¯
echo "ğŸ”¨ æ„å»ºå‰ç«¯..."
cd client
npm run build
cd ..

# é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
pm2 restart all

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œéƒ¨ç½²
./deploy.sh
```

## å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ç¡®è®¤æœåŠ¡å™¨ä¸Šæœ‰ Node.js (v16+)
- [ ] ç¡®è®¤æœåŠ¡å™¨ä¸Šæœ‰ npm æˆ– yarn
- [ ] ç¡®è®¤æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
- [ ] å¤‡ä»½å½“å‰è¿è¡Œçš„ç‰ˆæœ¬

### éƒ¨ç½²æ­¥éª¤
1. [ ] ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
2. [ ] å®‰è£…æ ¹ç›®å½•ä¾èµ– (`npm install`)
3. [ ] å®‰è£…æœåŠ¡å™¨ä¾èµ– (`cd server && npm install`)
4. [ ] å®‰è£…å®¢æˆ·ç«¯ä¾èµ– (`cd client && npm install`)
5. [ ] æ„å»ºå‰ç«¯ (`cd client && npm run build`)
6. [ ] æ£€æŸ¥æ„å»ºç»“æœ (`ls -la client/build`)
7. [ ] é‡å¯æœåŠ¡ (`pm2 restart all`)
8. [ ] éªŒè¯æœåŠ¡çŠ¶æ€ (`pm2 status`)
9. [ ] æµ‹è¯•ç½‘ç«™è®¿é—®

### éƒ¨ç½²åéªŒè¯
- [ ] æ£€æŸ¥å‰ç«¯é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½
- [ ] æ£€æŸ¥ API æ¥å£æ˜¯å¦æ­£å¸¸å“åº”
- [ ] æ£€æŸ¥æ–°åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ¸…ç† npm ç¼“å­˜
npm cache clean --force

# æ¸…ç†æ—§çš„ node_modules
find . -name "node_modules" -type d -prune -exec rm -rf '{}' +
```

### 2. æƒé™é—®é¢˜
```bash
# ä¿®æ”¹é¡¹ç›®ç›®å½•æƒé™
sudo chown -R $USER:$USER /var/www/mj-gallery

# æˆ–è€…ä½¿ç”¨ sudo æ‰§è¡Œ npm å‘½ä»¤
sudo npm install
```

### 3. Node.js ç‰ˆæœ¬ä¸å…¼å®¹
```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version

# å¦‚æœç‰ˆæœ¬è¿‡ä½ï¼Œå‡çº§ Node.js
# ä½¿ç”¨ nvm ç®¡ç† Node.js ç‰ˆæœ¬
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18
```

### 4. ç½‘ç»œé—®é¢˜å¯¼è‡´å®‰è£…å¤±è´¥
```bash
# ä½¿ç”¨æ·˜å®é•œåƒ
npm config set registry https://registry.npmmirror.com

# æˆ–è€…ä½¿ç”¨ cnpm
npm install -g cnpm --registry=https://registry.npmmirror.com
cnpm install
```

## æœ€ä½³å®è·µ

### 1. ç¯å¢ƒä¸€è‡´æ€§
- æœ¬åœ°å’ŒæœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„ Node.js ç‰ˆæœ¬
- ä½¿ç”¨ `.nvmrc` æ–‡ä»¶é”å®š Node.js ç‰ˆæœ¬
- ä½¿ç”¨ `package-lock.json` é”å®šä¾èµ–ç‰ˆæœ¬

### 2. éƒ¨ç½²è‡ªåŠ¨åŒ–
- ä½¿ç”¨ CI/CD å·¥å…·è‡ªåŠ¨åŒ–éƒ¨ç½²
- åˆ›å»ºéƒ¨ç½²è„šæœ¬å‡å°‘äººä¸ºé”™è¯¯
- è®¾ç½®éƒ¨ç½²å‰çš„è‡ªåŠ¨åŒ–æµ‹è¯•

### 3. å›æ»šç­–ç•¥
- éƒ¨ç½²å‰å¤‡ä»½å½“å‰ç‰ˆæœ¬
- ä¿ç•™å¤šä¸ªç‰ˆæœ¬çš„æ„å»ºç»“æœ
- å‡†å¤‡å¿«é€Ÿå›æ»šè„šæœ¬

### 4. ç›‘æ§å’Œæ—¥å¿—
- ç›‘æ§éƒ¨ç½²è¿‡ç¨‹çš„æ¯ä¸ªæ­¥éª¤
- è®°å½•è¯¦ç»†çš„éƒ¨ç½²æ—¥å¿—
- è®¾ç½®æœåŠ¡çŠ¶æ€ç›‘æ§å‘Šè­¦

## é¢„é˜²æªæ–½

### 1. æœ¬åœ°æµ‹è¯•
```bash
# åœ¨æœ¬åœ°å®Œæ•´æµ‹è¯•æ„å»ºè¿‡ç¨‹
npm run build

# æµ‹è¯•æ„å»ºç»“æœ
npm run start
```

### 2. åˆ†é˜¶æ®µéƒ¨ç½²
1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²
2. éªŒè¯åŠŸèƒ½æ­£å¸¸åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
3. ä½¿ç”¨è“ç»¿éƒ¨ç½²æˆ–æ»šåŠ¨éƒ¨ç½²

### 3. ä¾èµ–ç®¡ç†
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- ä½¿ç”¨ `npm audit` æ£€æŸ¥å®‰å…¨æ¼æ´
- é¿å…ä½¿ç”¨ä¸ç¨³å®šçš„ä¾èµ–ç‰ˆæœ¬

## æ–‡ä»¶æ¸…å•

### æœ¬æ¬¡ä¿®æ”¹æ¶‰åŠçš„æ–‡ä»¶
```
æ–°å¢æ–‡ä»¶:
- client/src/components/UI/Pagination.js

ä¿®æ”¹æ–‡ä»¶:
- client/src/pages/Explore.js

å¼€å‘æ—¥å¿—:
- å¼€å‘ç¯å¢ƒå¼€å‘æ—¥å¿—/2024-01-åˆ†é¡µåŠŸèƒ½å¼€å‘æ—¥å¿—.md
- å¼€å‘ç¯å¢ƒå¼€å‘æ—¥å¿—/æœåŠ¡å™¨éƒ¨ç½²é—®é¢˜è§£å†³æ–¹æ¡ˆ.md
```

### éƒ¨ç½²æ—¶éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶
```
# æºä»£ç æ–‡ä»¶
client/src/components/UI/Pagination.js
client/src/pages/Explore.js

# ä¸éœ€è¦ä¸Šä¼ 
node_modules/          # é€šè¿‡ npm install å®‰è£…
client/build/          # é€šè¿‡ npm run build ç”Ÿæˆ
```

## æ€»ç»“

**é—®é¢˜æ ¹æº**ï¼šæœåŠ¡å™¨ç¼ºå°‘ `node_modules` ä¾èµ–åŒ…

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå®Œæ•´çš„ä¾èµ–å®‰è£…å’Œæ„å»ºæµç¨‹

**å…³é”®æ­¥éª¤**ï¼š
1. `npm install` - å®‰è£…ä¾èµ–
2. `npm run build` - æ„å»ºå‰ç«¯
3. `pm2 restart all` - é‡å¯æœåŠ¡

**é¢„é˜²æªæ–½**ï¼šå»ºç«‹æ ‡å‡†åŒ–çš„éƒ¨ç½²æµç¨‹å’Œè‡ªåŠ¨åŒ–è„šæœ¬

---

**åˆ›å»ºæ—¶é—´**: 2024å¹´1æœˆ
**é—®é¢˜çŠ¶æ€**: âœ… å·²åˆ†æ
**è§£å†³çŠ¶æ€**: ğŸ“‹ å¾…æ‰§è¡Œ
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ä¼˜å…ˆçº§